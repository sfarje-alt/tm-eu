name: Daily EU Trademark Scraper

on:
  repository_dispatch:
    types: [scrape_now]  # API trigger
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:

# rest stays the same...

jobs:
  scrape:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Setup Chrome
      uses: browser-actions/setup-chrome@v1
      with:
        chrome-version: stable
    
    - name: Install Python dependencies
      run: |
        pip install selenium pandas openpyxl webdriver-manager requests
    
    - name: Create test scraper script
      run: |
        cat > test_scraper.py << 'EOF'
        import os
        import json
        import pandas as pd
        from datetime import datetime
        
        print("Starting test scraper...")
        
        # Create data directory
        os.makedirs('data', exist_ok=True)
        
        # Create test data
        today = datetime.now().strftime('%Y%m%d')
        
        # Create sample trademark data
        data = {
            'ApplicationNumber': ['EU123456', 'EU123457'],
            'TradeMark': ['TestMark1', 'TestMark2'],
            'Applicant': ['Company A', 'Company B'],
            'Status': ['Published', 'Published'],
            'PublicationDate': [datetime.now().strftime('%Y-%m-%d')] * 2,
            'Classes': ['1, 2, 3', '4, 5, 6']
        }
        
        df = pd.DataFrame(data)
        
        # Save as Excel
        excel_file = f'data/eu_trademarks_{today}.xlsx'
        df.to_excel(excel_file, index=False)
        print(f"Created: {excel_file}")
        
        # Save as JSON
        json_file = f'data/eu_trademarks_{today}.json'
        df.to_json(json_file, orient='records', date_format='iso')
        print(f"Created: {json_file}")
        
        print("Test scraper completed successfully!")
        EOF
        
    - name: Run test scraper
      run: python test_scraper.py
    
    - name: List created files
      run: ls -la data/
    
    - name: Commit and push data
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add data/*.xlsx data/*.json || true
        git commit -m "Update trademark data - $(date +'%Y-%m-%d')" || echo "No changes to commit"
        git push || echo "No changes to push"
